---
layout: post
title: iOS直播app个人实践--采集推流篇
date: 2015-12-31 15:32:24.000000000 +09:00
tags: [LiveVideo , Video , Auido , TransferProtocol]
---

如果不了解原理，可以看这篇文章[iOS直播app个人实践--原理篇](http://garfieldlover.github.io/2015/12/iOS%E7%9B%B4%E6%92%ADapp%E4%B8%AA%E4%BA%BA%E5%AE%9E%E8%B7%B5-%E5%8E%9F%E7%90%86%E7%AF%87)。

开发一款直播app，首先需要采集主播的视频和音频（包括美颜），然后传入流媒体服务器，iOS端用AVFoundation实现音视频的采集，下边介绍常用功能。

## 一、AVFoundation基本功能
#### 1.1、常用功能类

```
插入以前看到的图片文章
```

- AVFoundation: 音视频数据采集需要用AVFoundation框架.
- 
- AVCaptureDevice：硬件设备，包括麦克风、摄像头，通过该对象可以设置物理设备的一些属性（例如相机聚焦、白平衡等）
- 
- AVCaptureDeviceInput：硬件输入对象，可以根据AVCaptureDevice创建对应的AVCaptureDeviceInput对象，用于管理硬件输入数据。
- AVCaptureOutput：硬件输出对象，用于接收各类输出数据，通常使用对应的子类AVCaptureAudioDataOutput（声音数据输出对象）、AVCaptureVideoDataOutput（视频数据输出对象）
- AVCaptionConnection:当把一个输入和输出添加到AVCaptureSession之后，AVCaptureSession就会在输入、输出设备之间建立连接,而且通过AVCaptureOutput可以获取这个连接对象。
- AVCaptureVideoPreviewLayer:相机拍摄预览图层，能实时查看拍照或视频录制效果，创建该对象需要指定对应的AVCaptureSession对象，因为AVCaptureSession包含视频输入数据，有视频数据才能展示。
- AVCaptureSession:  协调输入与输出之间传输数据
系统作用：可以操作硬件设备
工作原理：让App与系统之间产生一个捕获会话，相当于App与硬件设备有联系了， 我们只需要把硬件输入对象和输出对象添加到会话中，会话就会自动把硬件输入对象和输出产生连接，这样硬件输入与输出设备就能传输音视频数据。
现实生活场景：租客（输入钱），中介（会话），房东（输出房），租客和房东都在中介登记，中介就会让租客与房东之间产生联系，以后租客就能直接和房东联系了。
